<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>登录</title>
    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
    <script type='text/javascript'>

        $(function () {
            $("#validateCode").keyup(function () {
                checkLoginValidateCode($(this).val());
            });

        });

        function uploadLoginValidateCode() {
            $("#loginValidateCode").attr("src", "/loginValidateCode?random=" + new Date().getMilliseconds());
        }


        function checkLoginValidateCode(validateCode) {
            var error = $("#validateCode").parent().next();
            if (validateCode != null && validateCode != "") {
                $.ajax({
                    type: "POST",
                    async: false,
                    url: "/checkLoginValidateCode?validateCode=" + validateCode,
                    success: function (json) {
                        if (json != null && json.code == 200 && json.status != null) {
                            if (json.status == true) {
                                error.html("恭喜你验证码，正确！！！！！");
                            } else if (json.status == false) {
                                error.html("验证码错误，请重新输入");
                            } else {
                                error.html("验证码过期，请重新输入");
                                uploadLoginValidateCode();
                            }
                        }
                        return false;
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert("服务器错误！状态码：" + XMLHttpRequest.status);
                        // 状态
                        console.log(XMLHttpRequest.readyState);
                        // 错误信息
                        console.log(textStatus);
                        return false;
                    }
                });
            } else {
                error.html("请输入验证码！");
            }
        }

    </script>
</head>
<body>
<div>
    <form action="/">
        <p>登录综合管理平台</p>
        <div>
            <input type="text" class="studentId" name="studentId" placeholder="工号/学号">
        </div>
        <div>
            <input type="password" placeholder="密码" class="password" name="password"/>
        </div>
        <div>
            <input type="text" class="validateCode" placeholder="验证码" id="validateCode" name="validateCode"/>
        </div>
        <div>
            <img id="loginValidateCode" height="40" width="150" style="cursor: pointer;" src="/loginValidateCode"
                 onclick="uploadLoginValidateCode();">
            <button type="submit"><span>登录</span></button>
        </div>
    </form>
</div>

<p style="color: red"></p>

</body>
</html>